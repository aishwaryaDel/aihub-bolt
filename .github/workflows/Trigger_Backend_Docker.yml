name: Backend Docker Pipeline Trigger

on:
  push:
    branches:
      - dev
    paths:
      - 'backend/**'

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - name: Print Environment Details
        run: |
          echo "ðŸš€ Backend Docker Build & Push Workflow"
          echo "Branch: ${{ github.ref }}"
          echo "Version: v${{ github.run_number }}" 
          echo "Commit SHA: ${{ github.sha }}"
          echo "Target Environment: dev"
          echo "ACR Name: ${{ vars.ACR_NAME_DEV }}"

  build-and-push:
    name: Dev
    needs: setup
    uses: aishwaryaDel/tesa-docker-build-and-push/.github/workflows/Backend_docker_build.yml@main
    with:
      environment: "dev"
      image_name: "backend-dev"
      # image_tag: ${{ github.sha }}
      image_tag: v${{ github.run_number }} # Auto-increment version
      acr_name: ${{ vars.ACR_NAME_DEV }}  # ACR name from GitHub variable 
    secrets:
      azure_creds: ${{ secrets.AZURE_CREDENTIALS_DEV }}
      docker_env: ${{ secrets.DOCKER_ENV_DEV }} 